---
const { projects = [] } = Astro.props;

// tags are coming from `tags`
const tags = Array.from(new Set(projects.flatMap((p) => p.tags ?? []))).sort();
---

<div class="mt-6 flex flex-wrap gap-2">
  <button class="chip active" data-tag="__all">All</button>
  {tags.map((t) => <button class="chip" data-tag={t}>{t}</button>)}
</div>

<div class="mt-6 grid gap-4 md:grid-cols-2">
  {projects.map((p) => (
    <article
      class="proj rounded-3xl border border-white/10 bg-white/5 p-6 transition hover:bg-white/10"
      data-tags={(p.tags ?? []).join("|")}
    >
      <div class="flex items-start justify-between gap-4">
        <div>
          <div class="text-lg font-semibold">{p.name}</div>
          <div class="mt-3 flex flex-wrap gap-2">
            {(p.tags ?? []).map((t) => (
              <span class="rounded-full border border-white/10 bg-black/30 px-2 py-1 text-xs text-white/70">{t}</span>
            ))}
          </div>
        </div>

        {p.link ? (
          <a
            class="rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-white/80 hover:bg-white/10"
            href={p.link}
            target="_blank"
            rel="noreferrer"
          >
            View
          </a>
        ) : null}
      </div>

      {p.bullets?.length ? (
        <ul class="mt-4 list-disc space-y-2 pl-5 text-sm text-white/70">
          {p.bullets.map((b) => <li>{b}</li>)}
        </ul>
      ) : null}
    </article>
  ))}
</div>

<style>
  .chip {
    border: 1px solid rgba(255, 255, 255, 0.12);
    background: rgba(255, 255, 255, 0.04);
    padding: 0.35rem 0.7rem;
    border-radius: 999px;
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.75);
  }
  .chip:hover {
    background: rgba(255, 255, 255, 0.08);
    color: white;
  }
  .chip.active {
    background: rgba(255, 255, 255, 0.14);
    color: white;
  }
</style>

<script is:inline>
  const chips = Array.from(document.querySelectorAll(".chip"));
  const cards = Array.from(document.querySelectorAll(".proj"));

  const setActive = (btn) => {
    chips.forEach((c) => c.classList.remove("active"));
    btn.classList.add("active");
  };

  chips.forEach((btn) => {
    btn.addEventListener("click", () => {
      setActive(btn);
      const tag = btn.dataset.tag;
      cards.forEach((card) => {
        const tech = card.dataset.tags || "";
        const show = tag === "__all" || tech.includes(tag);
        card.style.display = show ? "" : "none";
      });
    });
  });
</script>
